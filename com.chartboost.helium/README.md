# Helium Unity SDK

[![Helium Unity SDK](https://github.com/ChartBoost/helium-unity-sdk/actions/workflows/helium-unity.yml/badge.svg?branch=develop)](https://github.com/ChartBoost/helium-unity-sdk/actions/workflows/helium-unity.yml)

Helium Unity SDK that is a compliant Unity Package.

## 1. Unit Tests
The Helium Unity SDK package contains a series of Unit tests to ensure functionality and callbacks behave as expected.

In order to enable test from the Helium SDK package, the following setup is needed in your Unity's project `manifest.json`, as follows:

```json
  "dependencies": {
    "com.unity.ide.vscode": "1.2.5",
    "com.unity.test-framework": "1.1.31",
    "com.unity.textmeshpro": "3.0.6",
    ...
  },
  "testables": ["com.chartboost.helium"]
```

Please refer to the following [Unity Documentation](https://docs.unity3d.com/Manual/cus-tests.html) for more information on Test in Packages and how to enabled them.

## 2. Samples & Google External Dependency Manager (EDM)

The Helium Unity SDK package contains samples with optional dependencies for ad adapters. Such samples can be found in the Package Manager / Sample sections.

Each Helium Unity SDK sample contains a .xml file with dependencies for the adapter available platforms (Android/iOS). In order for such dependencies to be included into the final build the [Google External Dependency Manager](https://github.com/googlesamples/unity-jar-resolver) is needed.
The EDM(External Dependency Manager) makes sure to download and package any dependencies with your build.

The EDM can be downloaded as a tarball or legacy .unitypackage from the following archive [Google Unity APIs Archive](https://developers.google.com/unity/archive#external_dependency_manager_for_unity). It is recommended to download the EDM as a tarball and integrate it through the package manager, as this will make sure future updates can be done without issues.

### Recommended External Dependency Manager (EDM) Setup

Since the EDM is meant to be a helper tool to sort out dependencies for Unity projects, it provides many approaches on how this can be done.
By default, the EDM will download any available dependencies into your project's **Assets/Plugins/Android** folder. Such approach is problematic since the more ad adapters you add, the more libraries and dependencies will be downloaded locally. As a result, your Android's Plugin folder might become saturated with files.

In order to have the most flexibility and clean approach when utilizing the EDM. It is recommended to have at least the 2 following files into your project:

Both of the following files can be generated by visiting the **Player Settings/Android/Publishing Settings/Build** section of your Unity project.

1. #### Custom Main Template (**Assets/Plugins/Android/mainTemplate.gradle**)
   * By having this file the EDM will patch any dependencies into it so they can be fetched during compilation/build time. This is great to avoid having dependencies embedded directly into your codebase. However, this also means that any new libraries will be downloaded the first time you attempt to make a build.
2. #### Custom Gradle Properties Template (**Assets/Plugins/Android/gradleTemplate.properties**)
   * Gradle Properties Template allows us to specify aspects of how we want our Android project to be handled. This is useful for the EDM when dealing with legacy Android Support Library and Migrations to AndroidX libraries. Once the correct settings are setup, the file should look like this:

     ```properties
     org.gradle.jvmargs=-Xmx**JVM_HEAP_SIZE**M
     org.gradle.parallel=true
     # Android Resolver Properties Start
     android.useAndroidX=true
     android.enableJetifier=true
     # Android Resolver Properties End
     android.enableR8=**MINIFY_WITH_R_EIGHT**
     unityStreamingAssets=**STREAMING_ASSETS**
     **ADDITIONAL_PROPERTIES**
     ```

### Recommended External Dependency Manager (EDM) Settings

#### Android

Right click on the Assets folder to see actions, then visit **External Dependency Manager/Android Resolver/Settings**

Make sure the following settings are setup as follows:

- [ ] Enable Auto Resolution
- [ ] Enable Resolution on Build
- [x] Patch mainTemplate.gradle
- [x] Use [Jetifier](https://developer.android.com/studio/command-line/jetifier)

The settings above will make sure resolution of dependencies does not happen automatically when adding new ..Dependency.xml files or when trying to make a build. This is ideal since you will only want to resolve dependencies when you know new libraries with Mobile Native dependencies are being added into the Unity project.

Additionally, you can notice that if you leave auto resolution & resolution on build enable without following the recommended setup stated above, the libraries will get automatically downloaded into your Unity project every time a new ..Dependency.xml file is added or when a build is generated.

By selecting to patch the mainTemplate.gradle, your dependencies should look something like this:

```gradle
dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
// Android Resolver Dependencies Start
    implementation 'androidx.appcompat:appcompat:1.3.0' // Assets/Samples/Helium SDK/3.0.0/Helium/Editor/HeliumDependencies.xml:29
    implementation 'androidx.core:core:1.2.0' // Assets/Samples/Helium SDK/3.0.0/Vungle/Editor/Optional-HeliumVungleDependencies.xml:10
    implementation 'androidx.localbroadcastmanager:localbroadcastmanager:1.0.0' // Assets/Samples/Helium SDK/3.0.0/Vungle/Editor/Optional-HeliumVungleDependencies.xml:9
    implementation 'com.adcolony:sdk:4.7.0' // Assets/Samples/Helium SDK/3.0.0/AdColony/Editor/Optional-HeliumAdColonyDependencies.xml:8
    implementation 'com.amazon.android:aps-sdk:9.4.3' // Assets/Samples/Helium SDK/3.0.0/Amazon/Editor/Optional-HeliumApsDependencies.xml:8
    implementation 'com.applovin:applovin-sdk:11.3.1' // Assets/Samples/Helium SDK/3.0.0/AppLovin/Editor/Optional-HeliumAppLovinDependencies.xml:8
    implementation 'com.chartboost:helium:2.10.+' // Assets/Samples/Helium SDK/3.0.0/Helium/Editor/HeliumDependencies.xml:10
    implementation 'com.chartboost:helium-adcolony:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/AdColony/Editor/Optional-HeliumAdColonyDependencies.xml:5
    implementation 'com.chartboost:helium-admob:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/AdMob/Editor/Optional-HeliumAdMobDependencies.xml:5
    implementation 'com.chartboost:helium-applovin:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/AppLovin/Editor/Optional-HeliumAppLovinDependencies.xml:5
    implementation 'com.chartboost:helium-aps:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/Amazon/Editor/Optional-HeliumApsDependencies.xml:5
    implementation 'com.chartboost:helium-facebook:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/Facebook/Editor/Optional-HeliumFacebookDependencies.xml:5
    implementation 'com.chartboost:helium-fyber:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/Fyber/Editor/Optional-HeliumFyberDependencies.xml:5
    implementation 'com.chartboost:helium-inmobi:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/InMobi/Editor/Optional-HeliumInMobiDependencies.xml:5
    implementation 'com.chartboost:helium-ironsource:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/IronSource/Editor/Optional-HeliumIronSourceDependencies.xml:5
    implementation 'com.chartboost:helium-mintegral:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/Mintegral/Editor/Optional-HeliumMintegralDependencies.xml:5
    implementation 'com.chartboost:helium-pangle:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/Pangle/Editor/Optional-HeliumPangleDependencies.xml:5
    implementation 'com.chartboost:helium-tapjoy:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/TapJoy/Editor/Optional-HeliumTapJoyDependencies.xml:5
    implementation 'com.chartboost:helium-unityads:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/UnityAds/Editor/Optional-HeliumUnityAdsDependencies.xml:5
    implementation 'com.chartboost:helium-vungle:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/Vungle/Editor/Optional-HeliumVungleDependencies.xml:5
    implementation 'com.chartboost:helium-yahoo:2.10.+@aar' // Assets/Samples/Helium SDK/3.0.0/Yahoo/Editor/Optional-HeliumYahooDependencies.xml:5
...
// Android Resolver Dependencies End
**DEPS**}
```

### iOS
Right click on the Assets folder to see actions, then visit **External Dependency Manager/iOS Resolver/Settings**

Make sure the following settings are setup as follows:

- [x] Pod File Generation
- [X] CocoaPods Integration -> XCodeWorkspace add cocoapods to the XCode Workspace
- [x] Auto install cocoapods in Editor

The default iOS setup should work right out of the box without issues. Please make sure that the settings above are correct.
When exporting an XCode project from Unity, the EDM will generate a .xcdworkspace file and the standard .xcodeproj. Please make sure to always open the .xcdworkspace for proper compatibility with the downloaded and installed pods.

If you have any CI/CD processes in place that target the .xcodeproj to manage your XCode project, please change it to utilize the .xcdworkspace instead.

When pods resolution is successful, the EDM generates the .xcdworkspace and no errors are shown in the Unity Console. If errors appear, it's generally related to a miss-matching pod dependency, this can be resolved by making sure all your dependencies are compatible with each other. (Make sure they are all up to date).

Pods can be found inside the XCode Workspace in an individual XCode Project called Pods.
